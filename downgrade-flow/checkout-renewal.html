<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Renewal Flow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Figma Design Tokens - Primary Blues
                        'ctct-blue': '#1856ed',
                        'ctct-blue-dark': '#1330bf',
                        'ctct-sapphire': '#12277d',
                        'ctct-sky': '#a6daff',
                        'ctct-arctic': '#d9f2ff',
                        'ctct-poolside': '#84dfff',
                        
                        // Figma Design Tokens - Neutrals
                        'ctct-gray': '#5d687e',
                        'ctct-light': '#f7f9fd',
                        'ctct-border': '#dce2ec',
                        'ctct-overcast': '#edf1f8',
                        'ctct-chinchilla': '#c9d0de',
                        'ctct-shadow': '#0f141c',
                        'ctct-dark': '#313b4d',
                        
                        // Figma Design Tokens - Alert/Success Colors
                        'ctct-warning': '#f79009',
                        'ctct-warning-bg': '#fff2de',
                        'ctct-orange': '#f79009',
                    }
                }
            }
        }
    </script>
    <style>
        /* Payment method selection */
        .payment-option input[type="radio"]:checked + label {
            border-color: #1856ed;
            background-color: #f7f9fd;
        }
        
        /* Custom radio button styling - target span after checked input */
        .billing-option input[type="radio"]:checked + span {
            background-color: white;
            border-color: #1856ed !important; /* Blue border for selected */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        /* Selected state - dark text for main label */
        .billing-option input[type="radio"]:checked + span .billing-label {
            color: #313b4d !important; /* Dark text */
        }
        
        /* Selected state - green text for savings */
        .billing-option input[type="radio"]:checked + span .billing-save {
            color: #16a34a !important; /* Green text */
        }
        
        /* Unselected state - gray text for all */
        .billing-option input[type="radio"]:not(:checked) + span .billing-label,
        .billing-option input[type="radio"]:not(:checked) + span .billing-save,
        .billing-option input[type="radio"]:not(:checked) + span .billing-current {
            color: #5D687E !important; /* Gray text */
        }
        
        /* Hover state for unselected options */
        .billing-option input[type="radio"]:not(:checked) + span:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body class="bg-ctct-light min-h-screen flex flex-col">
    
    <!-- Header -->
    <header class="bg-ctct-blue px-4 sm:px-6 lg:px-8 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center">
                <img src="ctct-logo-white.png" alt="Constant Contact" class="h-8 w-auto">
            </div>
            
            <!-- Close Button -->
            <button class="text-white hover:text-white/80 transition-colors p-2" aria-label="Close">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
    </header>

    <!-- Progress Stepper -->
    <div class="bg-white border-b border-ctct-border">
        <div class="max-w-3xl mx-auto px-4 py-6">
            <div class="flex items-center">
                <!-- Step 1: Select plan (completed - clickable) -->
                <div class="flex flex-col items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity" id="step-select-plan">
                    <div class="w-5 h-5 rounded-full bg-ctct-blue flex items-center justify-center flex-shrink-0">
                        <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium text-gray-500 whitespace-nowrap">Select plan</span>
                </div>
                
                <!-- Connector (completed) -->
                <div class="flex-1 h-px bg-ctct-blue mx-4 -mt-6"></div>
                
                <!-- Step 2: Add-ons (completed - clickable) -->
                <div class="flex flex-col items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity" id="step-addons">
                    <div class="w-5 h-5 rounded-full bg-ctct-blue flex items-center justify-center flex-shrink-0">
                        <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium text-gray-500 whitespace-nowrap">Add-ons</span>
                </div>
                
                <!-- Connector (completed) -->
                <div class="flex-1 h-px bg-ctct-blue mx-4 -mt-6"></div>
                
                <!-- Step 3: Checkout (active) -->
                <div class="flex flex-col items-center gap-2">
                    <div class="w-5 h-5 rounded-full border-2 border-ctct-blue bg-white flex items-center justify-center flex-shrink-0">
                        <div class="w-2 h-2 rounded-full bg-ctct-blue"></div>
                    </div>
                    <span class="text-sm font-semibold text-gray-900 whitespace-nowrap">Checkout</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1 px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
        <div class="max-w-6xl mx-auto">
            
            <!-- Prepay and Nonprofit Discounts Section -->
            <div class="bg-white rounded-xl p-4 sm:p-6 mb-6 sm:mb-8 shadow-sm">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg sm:text-xl font-semibold text-gray-900">Prepay and nonprofit discounts</h2>
                    <button class="text-ctct-blue hover:text-ctct-blue-dark p-1" aria-label="Learn more">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </button>
                </div>
                
                <div class="flex flex-col lg:flex-row lg:items-center gap-4">
                    <!-- Billing Period Options -->
                    <div class="w-full lg:flex-1 flex flex-wrap items-stretch gap-2 sm:gap-1 sm:flex sm:rounded-lg sm:border sm:border-ctct-border sm:p-1 bg-ctct-light sm:bg-white">
                        <!-- Monthly -->
                        <label class="billing-option flex-1 flex">
                            <input type="radio" name="billing" value="monthly" class="sr-only">
                            <span class="flex flex-col justify-center w-full px-4 sm:px-6 py-3 rounded-lg sm:rounded-md text-center cursor-pointer border-2 border-transparent bg-ctct-light transition-all">
                                <span class="billing-label block text-sm font-medium">Monthly</span>
                            </span>
                        </label>
                        
                        <!-- Prepay 6 months -->
                        <label class="billing-option flex-1 flex">
                            <input type="radio" name="billing" value="6months" class="sr-only">
                            <span class="flex flex-col justify-center w-full px-4 sm:px-6 py-3 rounded-lg sm:rounded-md text-center cursor-pointer border-2 border-transparent bg-ctct-light transition-all">
                                <span class="billing-label block text-sm font-medium">Prepay 6 months</span>
                                <span class="billing-save block text-xs font-medium">SAVE 10%</span>
                            </span>
                        </label>
                        
                        <!-- Prepay 12 months (Current plan) -->
                        <label class="billing-option flex-1 flex">
                            <input type="radio" name="billing" value="12months" class="sr-only">
                            <span class="flex flex-col justify-center w-full px-4 sm:px-6 py-3 rounded-lg sm:rounded-md text-center cursor-pointer border-2 border-transparent bg-ctct-light transition-all">
                                <span class="billing-label block text-sm font-medium">Prepay 12 months</span>
                                <span class="billing-save block text-xs font-medium">SAVE 15%</span>
                                <span class="billing-current block text-xs">Current</span>
                            </span>
                        </label>
                    </div>
                    
                    <!-- Nonprofit Toggle -->
                    <div class="flex items-center gap-3 flex-shrink-0">
                        <span class="text-sm text-gray-700">Nonprofit?</span>
                        <button type="button" role="switch" aria-checked="false" class="nonprofit-toggle relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent bg-gray-200 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-ctct-blue focus:ring-offset-2">
                            <span class="translate-x-0 pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"></span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Warning Alert for billing change -->
            <div id="billing-warning" class="hidden bg-ctct-warning-bg border border-ctct-warning/30 rounded-xl p-4 mb-6 sm:mb-8">
                <div class="flex items-center gap-3">
                    <div class="flex-shrink-0">
                        <svg class="w-5 h-5 text-ctct-warning" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <p id="billing-warning-text" class="text-sm text-ctct-dark"></p>
                </div>
            </div>

            <!-- Two Column Layout -->
            <div class="flex flex-col lg:flex-row gap-6 lg:items-stretch">
                
                <!-- Left Column - Payment & Billing -->
                <div class="flex-1 flex flex-col gap-6">
                    
                    <!-- Payment Method -->
                    <div class="bg-white rounded-xl p-6 border border-ctct-border">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Payment method</h3>
                        
                        <!-- Payment Options -->
                        <div class="flex gap-2 mb-4">
                            <label class="payment-option flex-1">
                                <input type="radio" name="payment" value="card" class="sr-only" checked>
                                <label class="block p-3 border-2 border-ctct-blue bg-ctct-light rounded-lg cursor-pointer">
                                    <svg class="w-5 h-5 text-ctct-blue mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                                    </svg>
                                    <span class="text-sm font-medium text-ctct-blue">Card</span>
                                </label>
                            </label>
                            
                            <label class="payment-option flex-1">
                                <input type="radio" name="payment" value="paypal" class="sr-only">
                                <label class="block p-3 border border-ctct-border rounded-lg cursor-pointer hover:border-ctct-blue transition-colors">
                                    <svg class="w-5 h-5 text-gray-500 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700">Paypal</span>
                                </label>
                            </label>
                            
                            <label class="payment-option flex-1">
                                <input type="radio" name="payment" value="bank" class="sr-only">
                                <label class="block p-3 border border-ctct-border rounded-lg cursor-pointer hover:border-ctct-blue transition-colors">
                                    <svg class="w-5 h-5 text-gray-500 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                                    </svg>
                                    <span class="text-sm text-gray-700">Us bank account</span>
                                </label>
                            </label>
                            
                            <button class="p-3 border border-ctct-border rounded-lg hover:border-ctct-blue transition-colors">
                                <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 24 24">
                                    <circle cx="6" cy="12" r="2"/>
                                    <circle cx="12" cy="12" r="2"/>
                                    <circle cx="18" cy="12" r="2"/>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Edit Link -->
                        <div class="text-right mb-4">
                            <a href="#" class="text-sm text-ctct-blue hover:text-ctct-blue-dark font-medium">Edit</a>
                        </div>
                        
                        <!-- Saved Card -->
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-700">American Express ending in **** ******** *<span class="font-semibold">8431</span></p>
                                <p class="text-sm text-ctct-gray">Expires 10/2029</p>
                            </div>
                            <div class="bg-[#006FCF] text-white text-xs font-bold px-2 py-1 rounded">AMEX</div>
                        </div>
                    </div>
                    
                    <!-- Billing Information -->
                    <div class="bg-white rounded-xl p-6 border border-ctct-border flex-1">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Billing information</h3>
                            <a href="#" class="text-sm text-ctct-blue hover:text-ctct-blue-dark font-medium">Edit</a>
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <!-- Address -->
                            <div>
                                <p class="text-sm font-medium text-gray-700 mb-1">Address:</p>
                                <p class="text-sm text-gray-900">Alexander Christopher</p>
                                <p class="text-sm text-gray-900">Alphabet Inc.</p>
                                <p class="text-sm text-gray-900">1600 Amphitheatre Parkway</p>
                                <p class="text-sm text-gray-900">Mountain View, CA</p>
                                <p class="text-sm text-gray-900">94043</p>
                                <p class="text-sm text-gray-900">United States</p>
                            </div>
                            
                            <!-- Phone & Email -->
                            <div>
                                <p class="text-sm font-medium text-gray-700 mb-1">Phone number:</p>
                                <p class="text-sm text-gray-900 mb-4">737 888 1234</p>
                                
                                <p class="text-sm font-medium text-gray-700 mb-1">Billing email:</p>
                                <p class="text-sm text-gray-900 break-all">alexander.christopher@billingaddress.com</p>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
                <!-- Right Column - Order Summary -->
                <div class="lg:w-96 flex-shrink-0">
                    <div class="bg-white rounded-xl p-6 border border-ctct-border">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Order summary</h3>
                        
                        <!-- Plan Charge (Dynamic) -->
                        <div id="plan-summary" class="mb-4 pb-4 border-b border-ctct-border">
                            <!-- Will be populated by JavaScript -->
                        </div>
                        
                        <!-- Add-ons (Dynamic) -->
                        <div id="addons-summary">
                            <!-- Will be populated by JavaScript -->
                        </div>
                        
                        <!-- Discount Code -->
                        <div class="mb-4 pb-4 border-b border-ctct-border">
                            <p class="text-sm text-gray-700 mb-2">Have a discount code?</p>
                            <div class="flex gap-2">
                                <input type="text" placeholder="Discount code" class="flex-1 px-3 py-2 border border-ctct-border rounded-lg text-sm focus:outline-none focus:border-ctct-blue">
                                <button class="px-4 py-2 border border-ctct-border rounded-lg text-sm text-ctct-gray hover:border-ctct-blue hover:text-ctct-blue transition-colors">
                                    Apply
                                </button>
                            </div>
                        </div>
                        
                        <!-- Totals (Dynamic) -->
                        <div id="totals-summary" class="space-y-2 mb-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                        
                        <!-- Legal Text -->
                        <div class="text-xs text-ctct-gray mb-4 space-y-3">
                            <p>
                                Auto renewal terms: All subscriptions automatically renew monthly, at the then current list price (plus applicable taxes), after your 14 day Free Trial, using the payment method on file, unless cancelled prior to your next bill date. Your monthly bill may increase depending on your highest contact list size and email and SMS sends. Overage Fees may apply. <a href="#" class="text-ctct-blue hover:underline">See overage fees & current contact tier pricing</a>. You may cancel at any time from your account or by calling 855-229-5506.
                            </p>
                            <p>
                                By submitting your payment you acknowledge that you have read and agree to our prepayment terms, the <a href="#" class="text-ctct-blue hover:underline">Terms of Service</a> and <a href="#" class="text-ctct-blue hover:underline">Privacy Notice</a>.
                            </p>
                        </div>
                        
                        <!-- Pay Button -->
                        <button id="pay-button" class="w-full py-3 px-4 rounded-full bg-ctct-orange text-gray-900 font-semibold hover:bg-orange-500 transition-colors flex items-center justify-center gap-2 mb-4">
                            <svg id="lock-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                            </svg>
                            <span id="pay-button-text">Pay 779.38 now</span>
                        </button>
                        
                        <!-- Payment Icons -->
                        <div class="flex items-center justify-center">
                            <img src="payment-icons.png" alt="Visa, Mastercard, American Express, Discover, PayPal" class="h-4 w-auto">
                        </div>
                    </div>
                </div>
                
            </div>
            
        </div>
    </main>
    <!-- JavaScript for Interactivity -->
    <script>
        // Warning alert elements
        const billingWarning = document.getElementById('billing-warning');
        const billingWarningText = document.getElementById('billing-warning-text');
        
        // Savings percentages for each billing option
        const billingSavings = {
            'monthly': 0,
            '6months': 10,
            '12months': 15
        };
        
        // Current/initial billing selection (user's existing plan)
        const initialBilling = '12months';
        const initialSavings = billingSavings[initialBilling];
        
        // Function to show/hide billing warning based on selection
        function updateBillingWarning(value) {
            const newSavings = billingSavings[value];
            const lostSavings = initialSavings - newSavings;
            
            if (value === 'monthly' && lostSavings > 0) {
                billingWarningText.textContent = `Switching to a monthly plan increases your annual cost by ${lostSavings}%`;
                billingWarning.classList.remove('hidden');
            } else if (value === '6months' && lostSavings > 0) {
                billingWarningText.textContent = `Switching to 6-month prepay increases your annual cost by ${lostSavings}%`;
                billingWarning.classList.remove('hidden');
            } else {
                billingWarning.classList.add('hidden');
            }
        }
        
        // Billing period configuration
        const billingConfig = {
            'monthly': { months: 1, discount: 0, label: 'Monthly', savingsLabel: '' },
            '6months': { months: 6, discount: 0.10, label: 'Prepay 6 months', savingsLabel: 'Prepay savings 10% discount' },
            '12months': { months: 12, discount: 0.15, label: 'Prepay 12 months', savingsLabel: 'Prepay savings 15% discount' }
        };
        
        // Function to remove an add-on
        function removeAddon(addonName) {
            const addonsJson = localStorage.getItem('selectedAddons');
            let addons = addonsJson ? JSON.parse(addonsJson) : [];
            
            // Filter out the addon with the matching name
            addons = addons.filter(addon => addon.name !== addonName);
            
            // Save back to localStorage
            localStorage.setItem('selectedAddons', JSON.stringify(addons));
            console.log('Removed addon:', addonName);
            
            // Re-render the order summary
            renderOrderSummary();
        }
        
        // Function to attach remove handlers
        function attachRemoveHandlers() {
            document.querySelectorAll('.remove-addon-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const addonName = this.getAttribute('data-addon-name');
                    if (addonName) {
                        removeAddon(addonName);
                    }
                });
            });
        }
        
        // Function to render order summary
        function renderOrderSummary() {
            const billing = localStorage.getItem('selectedBilling') || '12months';
            const billingInfo = billingConfig[billing];
            
            // Get selected plan
            const planJson = localStorage.getItem('selectedPlan');
            const plan = planJson ? JSON.parse(planJson) : { name: 'Lite', basePrice: 12, discountedPrice: 8.40, contacts: '0 - 500' };
            
            // Get selected add-ons
            const addonsJson = localStorage.getItem('selectedAddons');
            const addons = addonsJson ? JSON.parse(addonsJson) : [];
            
            // Calculate plan total
            const planMonthlyPrice = plan.discountedPrice;
            const planSubtotal = planMonthlyPrice * billingInfo.months;
            const planDiscount = planSubtotal * billingInfo.discount;
            const planTotal = planSubtotal - planDiscount;
            
            // Render plan section
            const planSummary = document.getElementById('plan-summary');
            let planDiscountHtml = '';
            if (billingInfo.discount > 0) {
                planDiscountHtml = `
                    <div class="flex justify-between mt-1">
                        <a href="#" class="text-xs text-green-600 hover:underline">${billingInfo.savingsLabel}</a>
                        <span class="text-xs text-green-600">-$${planDiscount.toFixed(2)}</span>
                    </div>`;
            }
            
            planSummary.innerHTML = `
                <div class="flex justify-between mb-1">
                    <span class="text-sm font-semibold text-gray-900">${plan.name}</span>
                    <span class="text-sm font-semibold text-gray-900">$${planTotal.toFixed(2)}</span>
                </div>
                <p class="text-xs text-ctct-gray">Contacts ${plan.contacts}</p>
                <p class="text-xs text-ctct-gray">${billingInfo.label} ($${planMonthlyPrice.toFixed(2)}/mo × ${billingInfo.months} mo)</p>
                ${planDiscountHtml}
                <a href="plan-selection-renewal.html" class="text-xs text-ctct-blue hover:underline">Edit plan</a>
            `;
            
            // Render add-ons section
            const addonsSummary = document.getElementById('addons-summary');
            let addonsHtml = '';
            let totalAddonsSubtotal = 0;
            let totalAddonsDiscount = 0;
            
            addons.forEach((addon, index) => {
                if (addon.price > 0) { // Skip free add-ons
                    const addonSubtotal = addon.price * billingInfo.months;
                    const addonDiscount = addonSubtotal * billingInfo.discount;
                    const addonTotal = addonSubtotal - addonDiscount;
                    
                    totalAddonsSubtotal += addonSubtotal;
                    totalAddonsDiscount += addonDiscount;
                    
                    let addonDiscountHtml = '';
                    if (billingInfo.discount > 0) {
                        addonDiscountHtml = `
                            <div class="flex justify-between mt-1">
                                <a href="#" class="text-xs text-green-600 hover:underline">${billingInfo.savingsLabel}</a>
                                <span class="text-xs text-green-600">-$${addonDiscount.toFixed(2)}</span>
                            </div>`;
                    }
                    
                    addonsHtml += `
                        <div class="mb-4 pb-4 border-b border-ctct-border addon-item" data-addon-index="${index}">
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-semibold text-gray-900">${addon.tier || addon.name}</span>
                                <span class="text-sm font-semibold text-gray-900">$${addonTotal.toFixed(2)}</span>
                            </div>
                            <p class="text-xs text-ctct-gray">${billingInfo.label} ($${addon.price}/mo × ${billingInfo.months} mo)</p>
                            ${addonDiscountHtml}
                            <div class="flex gap-3 mt-1">
                                <a href="addons-renewal.html" class="text-xs text-ctct-blue hover:underline">Edit add-on</a>
                                <a href="#" class="text-xs text-ctct-blue hover:underline remove-addon-link" data-addon-name="${addon.name}">Remove</a>
                            </div>
                        </div>
                    `;
                } else {
                    // Free add-ons
                    addonsHtml += `
                        <div class="mb-4 pb-4 border-b border-ctct-border addon-item" data-addon-index="${index}">
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-semibold text-gray-900">${addon.tier || addon.name}</span>
                                <span class="text-sm font-semibold text-gray-900">Free</span>
                            </div>
                            <p class="text-xs text-ctct-gray">${addon.tier}</p>
                            <div class="flex gap-3 mt-1">
                                <a href="addons-renewal.html" class="text-xs text-ctct-blue hover:underline">Edit add-on</a>
                                <a href="#" class="text-xs text-ctct-blue hover:underline remove-addon-link" data-addon-name="${addon.name}">Remove</a>
                            </div>
                        </div>
                    `;
                }
            });
            
            // Show add-ons if selected, otherwise leave empty for more space
            addonsSummary.innerHTML = addonsHtml;
            
            // Attach remove handlers after rendering
            attachRemoveHandlers();
            
            // Calculate totals
            const subtotal = planSubtotal + totalAddonsSubtotal;
            const totalSavings = planDiscount + totalAddonsDiscount;
            const taxRate = 0.10; // 10% tax
            const subtotalAfterDiscount = subtotal - totalSavings;
            const tax = subtotalAfterDiscount * taxRate;
            const total = subtotalAfterDiscount + tax;
            
            // Render totals section
            const totalsSummary = document.getElementById('totals-summary');
            let savingsHtml = '';
            if (totalSavings > 0) {
                savingsHtml = `
                    <div class="flex justify-between">
                        <span class="text-sm text-green-600 font-medium">Total savings</span>
                        <span class="text-sm text-green-600 font-medium">–$${totalSavings.toFixed(2)}</span>
                    </div>`;
            }
            
            totalsSummary.innerHTML = `
                <div class="flex justify-between">
                    <span class="text-sm text-gray-700">Subtotal before tax</span>
                    <span class="text-sm text-gray-900">$${subtotalAfterDiscount.toFixed(2)}</span>
                </div>
                ${savingsHtml}
                <div class="flex justify-between">
                    <span class="text-sm text-gray-700">Tax</span>
                    <span class="text-sm text-gray-900">$${tax.toFixed(2)}</span>
                </div>
                <div class="flex justify-between pt-2 border-t border-ctct-border">
                    <span class="text-sm font-semibold text-gray-900">Today's total</span>
                    <span class="text-sm font-semibold text-gray-900">$${total.toFixed(2)}</span>
                </div>
            `;
            
            // Update pay button text
            const payButtonText = document.getElementById('pay-button-text');
            if (payButtonText) {
                payButtonText.textContent = `Pay $${total.toFixed(2)} now`;
            }
        }
        
        // Load saved billing selection from localStorage
        const savedBilling = localStorage.getItem('selectedBilling');
        if (savedBilling) {
            const billingRadio = document.querySelector(`input[name="billing"][value="${savedBilling}"]`);
            if (billingRadio) {
                billingRadio.checked = true;
            }
            // Show warning if needed based on saved selection
            updateBillingWarning(savedBilling);
        } else {
            // Default to 12 months if no saved selection
            document.querySelector('input[name="billing"][value="12months"]').checked = true;
        }
        
        // Render order summary on page load
        renderOrderSummary();
        
        // Load saved nonprofit status from localStorage
        const savedNonprofit = localStorage.getItem('isNonprofit');
        if (savedNonprofit === 'true') {
            const nonprofitToggle = document.querySelector('.nonprofit-toggle');
            nonprofitToggle.setAttribute('aria-checked', 'true');
            nonprofitToggle.classList.remove('bg-gray-200');
            nonprofitToggle.classList.add('bg-ctct-blue');
            const toggle = nonprofitToggle.querySelector('span');
            toggle.classList.remove('translate-x-0');
            toggle.classList.add('translate-x-5');
        }
        
        // Billing option selection - save to localStorage when changed
        document.querySelectorAll('.billing-option input').forEach(radio => {
            radio.addEventListener('change', function() {
                const value = this.value;
                console.log('Selected billing period:', value);
                localStorage.setItem('selectedBilling', value);
                
                // Show/hide warning based on selection
                updateBillingWarning(value);
                
                // Re-render order summary with new billing period
                renderOrderSummary();
            });
        });

        // Nonprofit toggle
        document.querySelector('.nonprofit-toggle')?.addEventListener('click', function() {
            const isChecked = this.getAttribute('aria-checked') === 'true';
            this.setAttribute('aria-checked', !isChecked);
            
            const toggle = this.querySelector('span');
            if (!isChecked) {
                this.classList.remove('bg-gray-200');
                this.classList.add('bg-ctct-blue');
                toggle.classList.remove('translate-x-0');
                toggle.classList.add('translate-x-5');
            } else {
                this.classList.remove('bg-ctct-blue');
                this.classList.add('bg-gray-200');
                toggle.classList.remove('translate-x-5');
                toggle.classList.add('translate-x-0');
            }
            
            // Save nonprofit status to localStorage
            localStorage.setItem('isNonprofit', !isChecked);
        });

        // Payment method selection
        document.querySelectorAll('.payment-option input').forEach(radio => {
            radio.addEventListener('change', function() {
                console.log('Selected payment method:', this.value);
            });
        });

        // Pay button handler with loading state
        document.getElementById('pay-button')?.addEventListener('click', function() {
            const button = this;
            const lockIcon = document.getElementById('lock-icon');
            const buttonText = document.getElementById('pay-button-text');
            
            // Disable button and show loading state
            button.disabled = true;
            button.classList.add('cursor-not-allowed', 'opacity-90');
            
            // Replace lock icon with spinner
            lockIcon.outerHTML = `<svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>`;
            
            // Change button text
            buttonText.textContent = 'Processing...';
            
            console.log('Processing payment...');
            
            // After 2 seconds, navigate to confirmation page
            setTimeout(function() {
                window.location.href = 'confirmation-renewal.html';
            }, 2000);
        });

        // Progress stepper navigation
        document.getElementById('step-select-plan')?.addEventListener('click', function() {
            window.location.href = 'plan-selection-renewal.html';
        });

        document.getElementById('step-addons')?.addEventListener('click', function() {
            window.location.href = 'addons-renewal.html';
        });
    </script>
</body>
</html>
